name: containerization 
on:
  workflow_dispatch:

jobs:
  Explore-GitHub-Actions:
# You need to use the INSTALLATION_NAME from the previous step
    runs-on: arc-runner-set
    steps:
    - run: echo "ðŸŽ‰ This job uses runner scale set runners!"
    - run: sudo apt update && sudo apt install -y git
          
    - name: Check out repository
      run: git clone https://github.com/enochnet/covid_case_privacy_review

    - name: Build and Scan CVE
      run: docker build -t r-app-cve-scan .

    - name: Tag Docker Image
      run: docker tag r-app-cve-scan r-app-cve-scan:latest
      
    - name: Create SBOM
      uses: anchore/sbom-action@v0
      with:
        format: cyclonedx-json
        output-file: "${{ github.event.repository.name }}-sbom.spdx.json"
      
    - name: Scan SBOM
      uses: anchore/scan-action@v3
      with:
        sbom: "${{ github.event.repository.name }}-sbom.spdx.json"
        fail-build: false
        output-format: json
        severity-cutoff: critical
       
    - name: Upload SBOM
      uses: actions/upload-artifact@v4.3.1
      with:
        name: sbom
        path: "${{ github.event.repository.name }}-sbom.spdx.json"